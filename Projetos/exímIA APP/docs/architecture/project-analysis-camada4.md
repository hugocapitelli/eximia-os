# Project Analysis: Camada 4 (Execution Intelligence) Integration

**Generated:** 2026-01-28
**Generated By:** @architect (Aria)
**Feature:** Camada 4 â€” Execution Intelligence Operating System
**Source Document:** `EXIMIA_OS_CAMADA4_PROPOSTA_IMPLEMENTACAO.md`

---

## Executive Summary

The **Camada 4 proposal** introduces an **Execution Intelligence Operating System** â€” a governance layer that transforms decisions into sustained human behavior. This analysis evaluates how to integrate this new architectural layer with the existing ExÃ­mIA APP infrastructure.

### Key Findings

| Aspect | Status | Recommendation |
|--------|--------|----------------|
| Architectural Fit | âš ï¸ Partial Overlap | Merge with Connection Layer |
| Agent System | âš ï¸ Parallel Concept | Unify with Synthetic Minds |
| Event System | âœ… Strong Alignment | Extend existing Event Bus |
| Data Model | ðŸ†• New Structures | Add 8+ new tables |
| UI/UX | ðŸ†• New Patterns | Design Decision Card + Ritual UI |
| MVP Scope | âš ï¸ Overly Ambitious | Reduce to 2 blocks |

---

## 1. Architectural Comparison

### Current ExÃ­mIA APP Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ExÃ­mIA APP (Current)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  MODULES (Horizontal)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Journey â”‚ Academy â”‚ Strategy â”‚ Brand â”‚ PrototypOS â”‚ Inboxâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â†•                                   â”‚
â”‚  CONNECTION LAYER (Horizontal Infrastructure)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Event Bus â”‚ Entity Links â”‚ Suggestion Engine â”‚ Cascades â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â†•                                   â”‚
â”‚  DATA LAYER (Persistence)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Supabase (PostgreSQL) â”‚ Redis â”‚ Vector DB (future)      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Proposed Camada 4 Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Camada 4 â€” Execution Intelligence (New)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  LAYER 5: KTEMA (Legacy)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Institutional Memory â”‚ Patterns â”‚ Organizational Knowledgeâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â†•                                   â”‚
â”‚  LAYER 4: EXECUTION INTELLIGENCE (FOCUS)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ NCE â”‚ Agents â”‚ Loops â”‚ Rituals â”‚ Governance â”‚ KTEMA Memoryâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â†•                                   â”‚
â”‚  LAYER 3: RITUALS & GOVERNANCE                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Decision Rituals â”‚ Tracking Rituals â”‚ Learning Rituals   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â†•                                   â”‚
â”‚  LAYER 2: DECISION & ACTION                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Decision Cards â”‚ Committed Actions â”‚ Expected Behaviors  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â†•                                   â”‚
â”‚  LAYER 1: DATA & EVENTS                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Human Inputs â”‚ System Events â”‚ Metrics â”‚ Signals         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Integrated Architecture (Recommended)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ExÃ­mIA OS â€” Unified Architecture                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  LAYER 5: KTEMA (Organizational Memory) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚ Decision History â”‚ Behavior Patterns â”‚ Institutional Knowledge â”‚  â”‚
â”‚                                                                     â”‚
â”‚  LAYER 4: EXECUTION INTELLIGENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚ NCE (Decision Cards) â”‚ Agent System â”‚ Execution Loops â”‚          â”‚
â”‚  â”‚ Rituals â”‚ Governance Rules â”‚                                     â”‚
â”‚                    â†•                                                 â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                     â”‚
â”‚  MODULES (Horizontal â€” Existing) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚ Journey â”‚ Academy â”‚ Strategy â”‚ Brand â”‚ PrototypOS â”‚ Inbox â”‚      â”‚
â”‚                    â†•                                                 â”‚
â”‚  CONNECTION LAYER (Extended) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚ Event Bus (+Decision Events) â”‚ Entity Links (+Decision Links) â”‚  â”‚
â”‚  â”‚ Suggestion Engine (+Agent Suggestions) â”‚ Cascades (+Loops)    â”‚  â”‚
â”‚                    â†•                                                 â”‚
â”‚  DATA LAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”‚ Supabase â”‚ Redis â”‚ Decision Store â”‚ Behavior Store â”‚              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Component Mapping Analysis

### 2.1 Event System Alignment

| Camada 4 Concept | ExÃ­mIA APP Equivalent | Integration Strategy |
|------------------|----------------------|----------------------|
| Decision Events | Event Bus events | **Extend** existing event catalog |
| Behavior Signals | No equivalent | **Add** new event types |
| Loop State Changes | Entity state tracking | **Extend** entity_links |
| Ritual Triggers | Scheduled notifications | **New** ritual scheduler |

**New Events to Add:**
```typescript
// Camada 4 Events
'decision.created'           // Decision Card created
'decision.abandoned'         // Decision without action for X days
'decision.loop_broken'       // Execution loop interrupted
'behavior.observed'          // Observable behavior registered
'behavior.deviation'         // Deviation from expected behavior
'ritual.scheduled'           // Ritual event scheduled
'ritual.executed'            // Ritual completed
'ritual.skipped'             // Ritual not executed
'loop.closed'                // Full loop completed
'ktema.pattern_detected'     // Learning pattern identified
```

### 2.2 Agent System Comparison

| Camada 4 Agent | Current Synthetic Minds | Recommendation |
|----------------|------------------------|----------------|
| Decision Guardian | No equivalent | **Add** as new Synthetic Mind |
| Execution Loop Agent | Suggestion Engine (partial) | **Extend** Suggestion Engine |
| Behavior Translator | No equivalent | **Add** as new Synthetic Mind |
| Drift Detector | No equivalent (notifications only) | **Add** as new Synthetic Mind |
| Learning Extractor | No equivalent | **Add** as new Synthetic Mind |
| KTEMA Memory Agent | No equivalent | **Add** as new Synthetic Mind |

**Unified Agent Architecture:**
```typescript
// Synthetic Minds Library Extension
interface SyntheticMind {
  id: string;
  name: string;
  category: 'personal' | 'execution' | 'learning' | 'governance';  // NEW categories
  keyQuestion: string;  // Camada 4 concept
  triggers: EventType[];
  actions: ActionType[];
}

// New agents for Camada 4
const executionMinds: SyntheticMind[] = [
  {
    id: 'decision-guardian',
    name: 'GuardiÃ£o da DecisÃ£o',
    category: 'execution',
    keyQuestion: 'Essa decisÃ£o ainda estÃ¡ viva?',
    triggers: ['decision.created', 'decision.abandoned'],
    actions: ['alert', 'suggest_action', 'escalate']
  },
  // ... other agents
];
```

### 2.3 Data Model Overlap

| Camada 4 Data | Existing Data | Overlap | Strategy |
|---------------|---------------|---------|----------|
| Decision Card | Strategy.initiative | **HIGH** | Merge: Decision Card IS enhanced Initiative |
| Expected Behavior | Journey.habit | **MEDIUM** | Extend: Habit gets behavior_type |
| Consequence Logic | No equivalent | **NONE** | New table |
| Closure Criteria | Journey.goal.completion_criteria | **MEDIUM** | Extend goals |
| Execution Loop | Entity Links graph | **HIGH** | Extend link relationships |
| Ritual | No equivalent | **NONE** | New table + scheduler |
| KTEMA Pattern | No equivalent | **NONE** | New table |

---

## 3. Data Model Extensions

### 3.1 New Tables Required

```sql
-- ===========================================
-- CAMADA 4: DECISION & ACTION LAYER
-- ===========================================

-- Decision Cards (Enhanced Initiatives)
CREATE TABLE decision_cards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users NOT NULL,

  -- Basic Info
  title TEXT NOT NULL,
  description TEXT,
  status decision_status DEFAULT 'draft',

  -- 5 Mandatory Questions (NCE)
  pain_point TEXT NOT NULL,              -- "Qual dor real ela resolve?"
  expected_behavior TEXT NOT NULL,       -- "Qual comportamento precisa mudar?"
  owner_id UUID REFERENCES auth.users,   -- "Quem sustenta no tempo?"
  success_criteria TEXT NOT NULL,        -- "Como sabemos se funcionou?"
  failure_consequence TEXT NOT NULL,     -- "O que acontece se nÃ£o acontecer?"

  -- Links
  linked_goal_id UUID REFERENCES goals,
  linked_initiative_id UUID REFERENCES initiatives,

  -- Lifecycle
  created_at TIMESTAMPTZ DEFAULT NOW(),
  activated_at TIMESTAMPTZ,
  deadline TIMESTAMPTZ,
  closed_at TIMESTAMPTZ,

  -- Metadata
  abandonment_days INTEGER DEFAULT 7,    -- Days before flagging as abandoned
  loop_status loop_status DEFAULT 'incomplete'
);

CREATE TYPE decision_status AS ENUM ('draft', 'active', 'closed', 'abandoned');
CREATE TYPE loop_status AS ENUM ('incomplete', 'partial', 'complete');

-- Expected Behaviors
CREATE TABLE expected_behaviors (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  decision_card_id UUID REFERENCES decision_cards NOT NULL,

  description TEXT NOT NULL,             -- Observable behavior description
  observable_indicator TEXT NOT NULL,    -- "O que verÃ­amos no chÃ£o?"
  frequency frequency_type,              -- How often expected
  target_metric TEXT,                    -- Quantifiable if possible

  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TYPE frequency_type AS ENUM ('daily', 'weekly', 'monthly', 'on_event');

-- Consequence Logic
CREATE TABLE consequence_logic (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  decision_card_id UUID REFERENCES decision_cards NOT NULL,

  condition_type consequence_condition NOT NULL,
  threshold_value TEXT,                  -- e.g., "7 days", "3 missed"
  action_type TEXT NOT NULL,             -- What happens when triggered
  escalation_level INTEGER DEFAULT 1,

  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TYPE consequence_condition AS ENUM (
  'no_action_days',      -- Decision without action
  'behavior_missed',     -- Expected behavior not observed
  'loop_broken',         -- Execution loop interrupted
  'deadline_approaching', -- Close to deadline
  'deadline_passed'      -- Past deadline
);

-- ===========================================
-- CAMADA 4: LOOPS & TRACKING
-- ===========================================

-- Execution Loops
CREATE TABLE execution_loops (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  decision_card_id UUID REFERENCES decision_cards NOT NULL,

  -- Loop Elements
  decision_id UUID REFERENCES decision_cards NOT NULL,
  action_id UUID,                        -- Committed action (polymorphic)
  action_type TEXT,                      -- 'goal', 'habit', 'task'
  behavior_id UUID REFERENCES expected_behaviors,
  indicator_id UUID,                     -- KPI or metric
  ritual_id UUID REFERENCES rituals,
  learning_id UUID REFERENCES learnings,

  -- Loop State
  status loop_element_status DEFAULT 'decision',
  completed_elements TEXT[] DEFAULT '{}',
  broken_at TEXT,                        -- Which element broke

  -- Timestamps
  started_at TIMESTAMPTZ DEFAULT NOW(),
  completed_at TIMESTAMPTZ,
  last_activity_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TYPE loop_element_status AS ENUM (
  'decision',    -- Decision made
  'action',      -- Action committed
  'behavior',    -- Behavior observed
  'indicator',   -- Indicator measured
  'ritual',      -- Ritual executed
  'learning',    -- Learning captured
  'complete'     -- Full loop
);

-- ===========================================
-- CAMADA 4: RITUALS
-- ===========================================

-- Rituals
CREATE TABLE rituals (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users NOT NULL,

  -- Ritual Definition
  name TEXT NOT NULL,
  type ritual_type NOT NULL,
  description TEXT,

  -- Schedule
  frequency ritual_frequency NOT NULL,
  scheduled_day INTEGER,                 -- Day of week (0-6) or month (1-31)
  scheduled_time TIME,
  duration_minutes INTEGER DEFAULT 30,

  -- Content
  guiding_questions TEXT[] DEFAULT '{}', -- Structured questions
  mandatory_outputs TEXT[] DEFAULT '{}', -- Required outputs

  -- Links
  linked_decision_ids UUID[] DEFAULT '{}',

  -- Status
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TYPE ritual_type AS ENUM (
  'decision',      -- Decision closure ritual
  'tracking',      -- Progress tracking (weekly)
  'learning',      -- Learning extraction (monthly)
  'alignment'      -- Cultural alignment
);

CREATE TYPE ritual_frequency AS ENUM (
  'daily', 'weekly', 'biweekly', 'monthly', 'quarterly'
);

-- Ritual Executions
CREATE TABLE ritual_executions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ritual_id UUID REFERENCES rituals NOT NULL,

  scheduled_at TIMESTAMPTZ NOT NULL,
  executed_at TIMESTAMPTZ,

  status ritual_execution_status DEFAULT 'scheduled',
  responses JSONB,                       -- Answers to guiding questions
  learnings TEXT,

  facilitator_id UUID REFERENCES auth.users,
  participants UUID[] DEFAULT '{}'
);

CREATE TYPE ritual_execution_status AS ENUM (
  'scheduled', 'in_progress', 'completed', 'skipped', 'rescheduled'
);

-- ===========================================
-- CAMADA 4: KTEMA (MEMORY)
-- ===========================================

-- Organizational Learnings
CREATE TABLE learnings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users NOT NULL,

  -- Source
  source_type TEXT NOT NULL,             -- 'decision', 'ritual', 'loop', 'manual'
  source_id UUID,

  -- Content
  insight TEXT NOT NULL,
  pattern_type pattern_type,
  context TEXT,

  -- Classification
  is_success BOOLEAN,                    -- Did it work?
  is_reusable BOOLEAN DEFAULT false,     -- Can be applied elsewhere?

  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TYPE pattern_type AS ENUM (
  'success_pattern',    -- What worked
  'failure_pattern',    -- What didn't work
  'process_pattern',    -- How things flow
  'behavior_pattern',   -- How people act
  'timing_pattern'      -- When things happen
);

-- KTEMA Memory (Long-term institutional memory)
CREATE TABLE ktema_memory (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Content
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  memory_type ktema_type NOT NULL,

  -- Links
  related_decisions UUID[] DEFAULT '{}',
  related_learnings UUID[] DEFAULT '{}',

  -- Metadata
  confidence_score FLOAT DEFAULT 0.5,
  usage_count INTEGER DEFAULT 0,
  last_accessed_at TIMESTAMPTZ,

  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TYPE ktema_type AS ENUM (
  'principle',          -- Organizational principle
  'best_practice',      -- Proven approach
  'anti_pattern',       -- What to avoid
  'template',           -- Reusable structure
  'case_study'          -- Documented case
);
```

### 3.2 Table Count Summary

| Category | New Tables | Existing Tables Extended |
|----------|-----------|--------------------------|
| Decision Layer | 3 (decision_cards, expected_behaviors, consequence_logic) | 1 (initiatives) |
| Loop Tracking | 1 (execution_loops) | 1 (entity_links) |
| Rituals | 2 (rituals, ritual_executions) | 0 |
| KTEMA | 2 (learnings, ktema_memory) | 0 |
| **TOTAL** | **8 new** | **2 extended** |

---

## 4. Integration Patterns

### 4.1 Connection Layer Extensions

```typescript
// Extend Event Catalog
const CAMADA4_EVENTS = {
  // Decision Events
  'decision.created': {
    data: { decision_card: DecisionCard },
    consumers: ['decision-guardian', 'execution-loop-agent']
  },
  'decision.activated': {
    data: { decision_card: DecisionCard },
    consumers: ['journey-module', 'strategy-module']
  },
  'decision.abandoned': {
    data: { decision_card: DecisionCard, days_inactive: number },
    consumers: ['decision-guardian', 'notifications']
  },

  // Loop Events
  'loop.element_completed': {
    data: { loop: ExecutionLoop, element: string },
    consumers: ['execution-loop-agent']
  },
  'loop.broken': {
    data: { loop: ExecutionLoop, broken_at: string },
    consumers: ['drift-detector', 'notifications']
  },

  // Ritual Events
  'ritual.due': {
    data: { ritual: Ritual, execution: RitualExecution },
    consumers: ['notifications', 'calendar']
  },
  'ritual.completed': {
    data: { execution: RitualExecution },
    consumers: ['learning-extractor', 'ktema-agent']
  },

  // KTEMA Events
  'ktema.pattern_detected': {
    data: { pattern: Learning, confidence: number },
    consumers: ['ktema-agent', 'suggestion-engine']
  }
};
```

### 4.2 Cascade Rules Extensions

```yaml
# New Cascading Rules for Camada 4

# Decision â†’ Goal
- name: decision_to_goal
  trigger: decision.activated
  conditions:
    - decision.linked_goal_id IS NULL
  action:
    type: suggest_create_goal
    prefill:
      title: "{{decision.title}}"
      linked_decision_id: "{{decision.id}}"

# Abandoned Decision Alert
- name: decision_abandoned_alert
  trigger: cron.daily
  query:
    decisions:
      status: active
      last_activity_at: { $lt: "-7d" }
  action:
    type: decision.abandoned
    for_each: true
    notification:
      type: alert
      priority: high
      title: "DecisÃ£o abandonada: {{decision.title}}"

# Ritual Due
- name: ritual_due_notification
  trigger: cron.hourly
  query:
    rituals:
      is_active: true
      next_scheduled: { $lte: "+1h" }
  action:
    type: ritual.due
    notification:
      type: reminder
      title: "Ritual: {{ritual.name}}"
      body: "Agendado para {{ritual.scheduled_time}}"

# Loop Completion â†’ Learning
- name: loop_completed_learning
  trigger: loop.element_completed
  conditions:
    - loop.status = 'complete'
  action:
    type: suggest_learning
    suggestion:
      title: "Extrair aprendizado do ciclo"
      prefill:
        source_type: 'loop'
        source_id: "{{loop.id}}"
```

### 4.3 Strategy Module Integration

The **Strategy** module should be extended to include Decision Cards:

```typescript
// Strategy Module Extension
interface StrategyModule {
  // Existing
  cycles: Cycle[];
  initiatives: Initiative[];
  kpis: KPI[];

  // NEW: Camada 4 Integration
  decisionCards: DecisionCard[];
  activeLoops: ExecutionLoop[];
  rituals: Ritual[];
}

// Initiative â†’ Decision Card migration
interface Initiative {
  // Existing fields...

  // NEW: Link to Decision Card
  decision_card_id?: string;

  // When initiative is created, optionally create Decision Card
  createDecisionCard?: boolean;
}
```

---

## 5. UI/UX Requirements

### 5.1 New Components Required

| Component | Type | Description |
|-----------|------|-------------|
| **DecisionCardForm** | Organism | Form with 5 mandatory questions |
| **DecisionCardView** | Organism | Display decision with loop status |
| **ExecutionLoopTracker** | Organism | Visual loop progress (6 elements) |
| **RitualScheduler** | Organism | Ritual calendar/scheduler |
| **RitualExecutor** | Page | Guided ritual execution |
| **LoopStatusBadge** | Atom | Visual indicator of loop state |
| **KTEMAInsightCard** | Molecule | Display learning/pattern |
| **AgentAlertPanel** | Organism | Agent notifications/suggestions |

### 5.2 Decision Card Form (Core UI)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ“ NOVA DECISÃƒO                                          [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  TÃ­tulo da DecisÃ£o *                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ LanÃ§ar MVP do ExÃ­mia.OS atÃ© 30/03                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  5 PERGUNTAS OBRIGATÃ“RIAS                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  1. Qual dor real essa decisÃ£o resolve? *                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Empreendedores usam ferramentas fragmentadas...              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  2. Qual comportamento precisa mudar? *                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Time deve entregar 1 feature completa por sprint...          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  ðŸ’¡ Dica: Descreva algo OBSERVÃVEL, nÃ£o abstrato                â”‚
â”‚                                                                 â”‚
â”‚  3. Quem sustenta essa decisÃ£o no tempo? *                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ðŸ‘¤ Hugo Capitelli (Founder)                            [â–¼]  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  4. Como sabemos se funcionou? *                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ MVP deployed + 100 users ativos + 40% retention...           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  5. O que acontece se NÃƒO acontecer? *                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Perda de janela de mercado, burn runway sem traÃ§Ã£o...        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  VINCULAÃ‡Ã•ES (opcional)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ðŸŽ¯ Vincular a Meta:     [Selecionar...]                        â”‚
â”‚  ðŸ“‹ Vincular a Iniciativa: [Selecionar...]                      â”‚
â”‚                                                                 â”‚
â”‚  [Cancelar]                      [Salvar como Rascunho] [Ativar]â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 Execution Loop Tracker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸ” LOOP DE EXECUÃ‡ÃƒO: LanÃ§ar MVP                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âœ… â”‚â”€â”€â”€â†’â”‚  âœ… â”‚â”€â”€â”€â†’â”‚  ðŸ”„ â”‚â”€â”€â”€â†’â”‚  â³ â”‚â”€â”€â”€â†’â”‚  â³ â”‚â”€â”€â”€â†’â”‚  â³ â”‚â”‚
â”‚  â”‚DECI-â”‚    â”‚AÃ‡ÃƒO â”‚    â”‚COMP-â”‚    â”‚INDI-â”‚    â”‚RITU-â”‚    â”‚APRENâ”‚â”‚
â”‚  â”‚SÃƒO  â”‚    â”‚     â”‚    â”‚ORTA-â”‚    â”‚CADORâ”‚    â”‚AL   â”‚    â”‚DIZA-â”‚â”‚
â”‚  â”‚     â”‚    â”‚     â”‚    â”‚MENTOâ”‚    â”‚     â”‚    â”‚     â”‚    â”‚DO   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  Status: ðŸ”„ COMPORTAMENTO (33% completo)                        â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  ðŸ“‹ DECISÃƒO (12/01)                                             â”‚
â”‚     "LanÃ§ar MVP do ExÃ­mia.OS atÃ© 30/03"                         â”‚
â”‚                                                                 â”‚
â”‚  âœ… AÃ‡ÃƒO COMPROMETIDA (15/01)                                   â”‚
â”‚     Meta criada: "Desenvolver plataforma" â†’ 45% progresso       â”‚
â”‚     HÃ¡bito criado: "Codar 2h/dia" â†’ Streak: 23 dias             â”‚
â”‚                                                                 â”‚
â”‚  ðŸ”„ COMPORTAMENTO ESPERADO                                      â”‚
â”‚     "Time entrega 1 feature/sprint"                             â”‚
â”‚     [Registrar observaÃ§Ã£o]                                      â”‚
â”‚                                                                 â”‚
â”‚  â³ INDICADOR                                                   â”‚
â”‚     Aguardando definiÃ§Ã£o de mÃ©trica                             â”‚
â”‚                                                                 â”‚
â”‚  â³ RITUAL                                                      â”‚
â”‚     PrÃ³ximo: "Review Semanal" em 3 dias                         â”‚
â”‚                                                                 â”‚
â”‚  â³ APRENDIZADO                                                 â”‚
â”‚     Aguardando conclusÃ£o do ciclo                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Module Inventory Update

### Current Modules

| Module | Status | Connection Layer Ready |
|--------|--------|------------------------|
| Journey | 0% code | âŒ Not implemented |
| Academy | 0% code | âŒ Not implemented |
| Strategy | 0% code | âŒ Not implemented |
| Brand | 0% code | âŒ Not implemented |
| PrototypOS | 0% code | âŒ Not implemented |
| Inbox | 0% code | âŒ Not implemented |

### New Modules (Camada 4)

| Module | Priority | Dependencies |
|--------|----------|--------------|
| **Decisions** (NCE) | P0 - MVP | Event Bus, Strategy |
| **Loops** | P0 - MVP | Decisions, Journey |
| **Rituals** | P1 - Phase 2 | Decisions, Notifications |
| **KTEMA** | P2 - Phase 3 | All modules, ML pipeline |

### Agent Inventory

| Agent | Type | Priority | Triggers |
|-------|------|----------|----------|
| Decision Guardian | Execution | P0 | decision.*, cron.daily |
| Execution Loop | Execution | P0 | loop.*, action.* |
| Behavior Translator | Execution | P1 | decision.activated |
| Drift Detector | Governance | P1 | cron.daily, loop.broken |
| Learning Extractor | Learning | P2 | ritual.completed, loop.complete |
| KTEMA Memory | Learning | P2 | learning.created, pattern.detected |

---

## 7. Pattern Analysis

### 7.1 Language & Framework

| Aspect | Current | Recommendation |
|--------|---------|----------------|
| Frontend | Next.js 16 + React 19 | âœ… Keep |
| Backend | Supabase Edge Functions | âœ… Keep, extend for agents |
| Database | PostgreSQL (Supabase) | âœ… Keep, add tables |
| Real-time | Supabase Realtime | âœ… Keep, use for agent alerts |
| Agent Runtime | None | ðŸ†• Add: Python FastAPI or Supabase Functions |

### 7.2 Testing Approach

| Layer | Framework | Priority |
|-------|-----------|----------|
| Unit Tests | Vitest | P0 |
| Integration | Vitest + Supabase local | P1 |
| E2E | Playwright | P2 |
| Agent Tests | Custom harness | P1 |

### 7.3 Configuration Pattern

```yaml
# camada4.config.yaml
execution_intelligence:
  decision_abandonment_days: 7
  loop_check_interval: "0 9 * * *"  # Daily at 9am

agents:
  decision_guardian:
    enabled: true
    alert_threshold_days: 7

  execution_loop:
    enabled: true
    check_interval: "daily"

  drift_detector:
    enabled: true
    sensitivity: "medium"

rituals:
  defaults:
    reminder_before_minutes: 30
    allow_reschedule: true

ktema:
  pattern_detection:
    min_occurrences: 3
    confidence_threshold: 0.7
```

---

## 8. Risk Assessment

### 8.1 Technical Risks

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| Agent system complexity | HIGH | HIGH | Start with 1 agent (Guardian) |
| Loop tracking overhead | MEDIUM | MEDIUM | Batch updates, async processing |
| Ritual adoption friction | HIGH | MEDIUM | Excellent UX, low barrier |
| KTEMA data quality | MEDIUM | LOW | Manual curation initially |

### 8.2 Architectural Risks

| Risk | Description | Mitigation |
|------|-------------|------------|
| **Scope creep** | 6 blocks is too much for MVP | Reduce to 2 blocks |
| **Parallel systems** | Camada 4 agents vs Synthetic Minds | Unify under one agent framework |
| **Data model complexity** | 8 new tables | Phase implementation |
| **Connection Layer dependency** | Camada 4 needs Event Bus | Build Connection Layer first |

### 8.3 Product Risks

| Risk | Description | Mitigation |
|------|-------------|------------|
| **Bureaucracy trap** | Rituals become checkbox exercise | Design for minimal friction |
| **Behavior mapping** | Abstract â†’ Observable is hard | Provide templates + examples |
| **User fatigue** | Too many alerts from agents | Smart throttling, user preferences |

---

## 9. Squad Configuration

### Recommended Team Structure

| Role | Agent | Responsibilities |
|------|-------|------------------|
| Primary | @dev | Implementation of Decision module, Loop tracking |
| Architecture | @architect | Data model, Agent framework, Integration patterns |
| UX | @ux-design-expert | Decision Card UI, Loop Tracker, Ritual UX |
| Data | @data-engineer | Schema design, RLS policies, Query optimization |
| QA | @qa | Test strategy, Agent behavior validation |

---

## 10. Success Metrics

### Technical Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Decision Cards created | >50 in pilot | Database count |
| Loop completion rate | >30% | Loops completed / created |
| Ritual compliance | >80% | Rituals executed / scheduled |
| Agent response time | <2s | P95 latency |
| System uptime | >99.5% | Monitoring |

### Business Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Decision â†’ Action conversion | >70% | Decisions with linked actions |
| Time decision â†’ execution | <7 days | Timestamp delta |
| ReincidÃªncia estratÃ©gica | <20% | Same problem recurring |
| User satisfaction | >4/5 | NPS survey |

---

## Summary

### Key Decisions Required

1. **Scope**: Accept MVP scope of 2 blocks (NCE + Loops) or push for more?
2. **Agent Framework**: Unify with Synthetic Minds or create separate?
3. **Priority**: Build Connection Layer first, then Camada 4?
4. **UI Strategy**: Design Decision Card UI before or during implementation?

### Recommended Next Steps

1. âœ… Review this analysis with stakeholders
2. Create `docs/architecture/recommended-approach-camada4.md`
3. Design Decision Card schema (simplified)
4. Prototype Decision Guardian agent
5. Plan Ritual system UX

---

**Generated by:** Aria (Architect Agent)
**Date:** 2026-01-28
**Status:** Ready for Review
